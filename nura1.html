<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuralCloud Browser 2.0</title>
    <style>
        :root {
            /* Core Colors */
            --primary-gradient-start: #667eea;
            --primary-gradient-end: #764ba2;
            --accent-magenta: #e91e63;
            --accent-navy: #1a237e;
            --navy-light: #303f9f;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            
            /* Glassmorphism */
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-blur: 10px;
            
            /* Shadows */
            --shadow-soft: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --shadow-strong: 0 12px 40px 0 rgba(31, 38, 135, 0.45);
            
            /* Animation Timings */
            --transition-quick: 0.2s;
            --transition-medium: 0.3s;
            
            /* Z-Index Layers */
            --layer-base: 1;
            --layer-sidebar: 50;
            --layer-modal: 100;
            --layer-tooltip: 200;
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
        }

        button {
            font-family: inherit;
        }

        /* Glassmorphic Components */
        .glass-container {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-soft);
        }

        .glass-modal {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow-strong);
        }

        /* Layout */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Brand Header */
        .brand-header {
            background: linear-gradient(to right, var(--accent-navy), var(--accent-magenta));
            padding: 15px 0;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 1px solid var(--glass-border);
        }

        /* Main Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: var(--accent-magenta);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            color: white;
            transition: transform var(--transition-quick);
            cursor: pointer;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .brand-text h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .brand-text p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Nura Status */
        .nura-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            transition: all var(--transition-quick);
        }

        .nura-status.processing {
            background: rgba(233, 30, 99, 0.2);
            animation: pulse 2s infinite;
        }

        .nura-status.thinking {
            background: rgba(26, 35, 126, 0.2);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        /* Browser Controls */
        .browser-controls {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .url-input-container, 
        .voice-command-container {
            position: relative;
            display: flex;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 12px;
            padding-left: 40px;
            padding-right: 40px;
            color: white;
            font-size: 16px;
            transition: all var(--transition-quick);
        }

        .input-field:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Voice Input */
        .mic-button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all var(--transition-quick);
        }

        .mic-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .mic-button.recording {
            background: rgba(233, 30, 99, 0.3);
            animation: pulseRed 2s infinite;
        }

        @keyframes pulseRed {
            0% { box-shadow: 0 0 0 0 rgba(233, 30, 99, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(233, 30, 99, 0); }
            100% { box-shadow: 0 0 0 0 rgba(233, 30, 99, 0); }
        }

        /* Quick Action Buttons */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .action-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--accent-navy);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all var(--transition-quick);
        }

        .action-button:hover {
            background: var(--navy-light);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);
        }

        .action-button svg {
            width: 18px;
            height: 18px;
        }

        /* Browser Frame */
        .browser-frame {
            width: 100%;
            height: 60vh;
            border: none;
            border-radius: 10px;
            background: white;
            margin-bottom: 20px;
            transition: all var(--transition-quick);
        }

        /* Audio Controls */
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .audio-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 50%;
            transition: all var(--transition-quick);
        }

        .audio-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .audio-button svg {
            width: 20px;
            height: 20px;
        }

        .audio-timer {
            font-family: monospace;
            font-size: 14px;
            color: var(--text-secondary);
            min-width: 60px;
        }

        /* Speed Control */
        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        /* Playlist */
        .playlist-container {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .playlist-items {
            display: grid;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .playlist-item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all var(--transition-quick);
        }

        .playlist-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* History Sidebar */
        .history-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 300px;
            background: rgba(26, 35, 126, 0.95);
            backdrop-filter: blur(var(--glass-blur));
            transform: translateX(-100%);
            transition: transform var(--transition-medium);
            z-index: var(--layer-sidebar);
            padding: 20px;
        }

        .history-sidebar.open {
            transform: translateX(0);
        }

        /* Modals */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: var(--layer-modal);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-backdrop.active {
            display: flex;
        }

        /* Settings Modal */
        .settings-modal {
            width: 90%;
            max-width: 500px;
        }

        /* Tooltips */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: var(--layer-tooltip);
            opacity: 0;
            transition: opacity var(--transition-quick);
        }

        .tooltip.visible {
            opacity: 1;
        }

        /* Loading Indicators */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            .quick-actions {
                grid-template-columns: 1fr 1fr;
            }

            .history-sidebar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Brand Header -->
    <div class="brand-header">
        <strong>NeuralCloud Browser 2.0</strong>
    </div>

    <div class="app-container">
        <!-- Main Header -->
        <header class="header glass-container">
            <div class="logo-container">
                <div class="logo">
                    <span>N</span>
                </div>
                <div class="brand-text">
                    <h1>NeuralCloud.ai</h1>
                    <p>Surf the Web. Ride the W2V</p>
                </div>
            </div>
            <div class="nura-status" id="nuraStatus">
                <svg class="sparkle-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 3l1.912 5.813a2 2 0 001.272 1.272L21 12l-5.813 1.912a2 2 0 00-1.272 1.272L12 21l-1.912-5.813a2 2 0 00-1.272-1.272L3 12l5.813-1.912a2 2 0 001.272-1.272L12 3z"/>
                </svg>
                <span>Nura is ready</span>
            </div>
        </header>

      <!-- Main Browser Interface -->
        <main class="browser-interface glass-container">
            <!-- Browser Controls -->
            <div class="browser-controls">
                <!-- URL Input with Voice -->
                <div class="url-input-container">
                    <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    </svg>
                    <input 
                        type="text" 
                        class="input-field" 
                        id="urlInput" 
                        placeholder="Enter URL or speak..."
                    />
                    <button class="mic-button" id="urlMicButton" title="Use voice input for URL">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" y1="19" x2="12" y2="23"/>
                            <line x1="8" y1="23" x2="16" y2="23"/>
                        </svg>
                    </button>
                </div>

                <!-- Voice Command Input -->
                <div class="voice-command-container">
                    <svg class="input-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 18.5a6.5 6.5 0 1 0 0-13 6.5 6.5 0 0 0 0 13Z"/>
                        <path d="m19 19-3.5-3.5"/>
                        <path d="M12 15l-3-3 3-3 3 3-3 3Z"/>
                    </svg>
                    <input 
                        type="text" 
                        class="input-field" 
                        id="commandInput" 
                        placeholder="Speak a command to Nura..." 
                        readonly
                    />
                    <button class="mic-button" id="commandMicButton" title="Use voice commands">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" y1="19" x2="12" y2="23"/>
                            <line x1="8" y1="23" x2="16" y2="23"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Browser Frame -->
            <iframe id="browserFrame" class="browser-frame" src="about:blank"></iframe>

            <!-- Audio Controls -->
            <div class="audio-controls">
                <button class="audio-button" id="playPauseButton" title="Play/Pause">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                </button>
                <button class="audio-button" id="stopButton" title="Stop">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="4" y="4" width="16" height="16"/>
                    </svg>
                </button>
                <div class="speed-control">
                    <span>Speed:</span>
                    <select id="speedSelect">
                        <option value="0.5">0.5x</option>
                        <option value="0.75">0.75x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.25">1.25x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                </div>
                <div class="audio-timer" id="audioTimer">00:00</div>
                <button class="audio-button" id="exportWavButton" title="Export as WAV">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                </button>
                <button class="audio-button" id="exportTextButton" title="Export as TXT">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10 9 9 9 8 9"/>
                    </svg>
                </button>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="action-button" id="summarizeButton">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    </svg>
                    Summarize
                </button>
                <button class="action-button" id="extractButton">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    Extract Data
                </button>
                <button class="action-button" id="qaButton">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    Q&A
                </button>
                <button class="action-button" id="explainButton">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    Explain
                </button>
            </div>

            <!-- Playlist Section -->
            <div class="playlist-container" id="playlistContainer">
                <div class="playlist-header">
                    <h3>Playlist (0/10)</h3>
                    <button class="action-button" id="processAllButton">Process All</button>
                </div>
                <div class="playlist-items" id="playlistItems">
                    <!-- Playlist items will be dynamically added here -->
                </div>
            </div>
        </main>

        <!-- History Sidebar -->
        <div class="history-sidebar" id="historySidebar">
            <div class="sidebar-header">
                <h3>History</h3>
                <button class="close-button" id="closeHistoryButton">×</button>
            </div>
            <div class="history-tabs">
                <button class="tab-button active" data-tab="browsing">Browsing</button>
                <button class="tab-button" data-tab="ai">AI Output</button>
            </div>
            <div class="history-content" id="historyContent">
                <!-- History items will be dynamically added here -->
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal-backdrop" id="settingsModal">
            <div class="settings-modal glass-modal">
                <h2>Settings</h2>
                <div class="settings-content">
                    <div class="setting-group">
                        <h3>Voice Settings</h3>
                        <div class="setting-item">
                            <label for="voiceSelect">Voice:</label>
                            <select id="voiceSelect"></select>
                        </div>
                        <div class="setting-item">
                            <label for="defaultSpeed">Default Speed:</label>
                            <select id="defaultSpeed">
                                <option value="0.5">0.5x</option>
                                <option value="0.75">0.75x</option>
                                <option value="1" selected>1x</option>
                                <option value="1.25">1.25x</option>
                                <option value="1.5">1.5x</option>
                                <option value="2">2x</option>
                            </select>
                        </div>
                    </div>
                    <div class="setting-group">
                        <h3>Playlist Settings</h3>
                        <div class="setting-item">
                            <label>
                                <input type="checkbox" id="autoPlayPlaylist">
                                Auto-play playlist items
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="action-button" id="saveSettings">Save Settings</button>
                    <button class="cancel-button" id="cancelSettings">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Core System Implementation
class NeuralCloudBrowser {
    constructor() {
        this.initializeComponents();
        this.setupEventListeners();
        this.setupSpeechSystems();
        this.setupAudioSystem();
    }

    // Component Initialization
    initializeComponents() {
        // DOM Elements - URL and Commands
        this.urlInput = document.getElementById('urlInput');
        this.urlMicButton = document.getElementById('urlMicButton');
        this.commandInput = document.getElementById('commandInput');
        this.commandMicButton = document.getElementById('commandMicButton');
        this.browserFrame = document.getElementById('browserFrame');
        this.nuraStatus = document.getElementById('nuraStatus');

        // Audio Controls
        this.playPauseButton = document.getElementById('playPauseButton');
        this.stopButton = document.getElementById('stopButton');
        this.speedSelect = document.getElementById('speedSelect');
        this.audioTimer = document.getElementById('audioTimer');
        this.exportWavButton = document.getElementById('exportWavButton');
        this.exportTextButton = document.getElementById('exportTextButton');

        // Quick Actions
        this.quickActionButtons = {
            summarize: document.getElementById('summarizeButton'),
            extract: document.getElementById('extractButton'),
            qa: document.getElementById('qaButton'),
            explain: document.getElementById('explainButton')
        };

        // Playlist Elements
        this.playlistContainer = document.getElementById('playlistContainer');
        this.playlistItems = document.getElementById('playlistItems');
        this.processAllButton = document.getElementById('processAllButton');

        // State Management
        this.isProcessing = false;
        this.currentAudioDuration = 0;
        this.playlist = [];
        this.history = {
            browsing: [],
            ai: []
        };
    }

    // Speech and Audio Systems
    setupSpeechSystems() {
        // Speech Recognition
        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
            this.urlRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            this.commandRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            
            this.setupSpeechRecognition(this.urlRecognition, 'url');
            this.setupSpeechRecognition(this.commandRecognition, 'command');
        }

        // Speech Synthesis
        if ('speechSynthesis' in window) {
            this.synthesis = window.speechSynthesis;
            this.loadVoices();
            speechSynthesis.addEventListener('voiceschanged', () => this.loadVoices());
        }
    }

    setupSpeechRecognition(recognition, type) {
        recognition.continuous = false;
        recognition.interimResults = true;

        recognition.onstart = () => {
            const button = type === 'url' ? this.urlMicButton : this.commandMicButton;
            button.classList.add('recording');
        };

        recognition.onend = () => {
            const button = type === 'url' ? this.urlMicButton : this.commandMicButton;
            button.classList.remove('recording');
        };

        recognition.onresult = (event) => {
            const transcript = Array.from(event.results)
                .map(result => result[0].transcript)
                .join('');

            if (event.results[0].isFinal) {
                if (type === 'url') {
                    this.handleUrlVoiceInput(transcript);
                } else {
                    this.handleCommandVoiceInput(transcript);
                }
            }
        };

        recognition.onerror = (event) => {
            console.error(`Speech recognition error: ${event.error}`);
            this.showError(`Speech recognition error: ${event.error}`);
        };
    }

    async handleUrlVoiceInput(transcript) {
        this.setNuraStatus('thinking', 'Nura is processing...');
        try {
            const processedUrl = await this.processWithGPT4(transcript, 'url-processing');
            this.urlInput.value = processedUrl;
            this.loadUrl(processedUrl);
        } catch (error) {
            this.showError('Failed to process voice input for URL');
            console.error('URL voice input error:', error);
        } finally {
            this.setNuraStatus('ready', 'Nura is ready');
        }
    }

    async handleCommandVoiceInput(transcript) {
        this.setNuraStatus('thinking', 'Nura is processing command...');
        try {
            const command = await this.processWithGPT4(transcript, 'command-processing');
            this.commandInput.value = transcript;
            this.executeCommand(command);
        } catch (error) {
            this.showError('Failed to process voice command');
            console.error('Command voice input error:', error);
        } finally {
            this.setNuraStatus('ready', 'Nura is ready');
        }
    }

    // Audio System Setup
    setupAudioSystem() {
        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        this.audioTimer = null;
        this.isPlaying = false;

        // Setup audio nodes
        this.gainNode = this.audioContext.createGain();
        this.analyser = this.audioContext.createAnalyser();
        this.gainNode.connect(this.analyser);
        this.analyser.connect(this.audioContext.destination);
    }

    loadVoices() {
        this.voices = this.synthesis.getVoices();
        const voiceSelect = document.getElementById('voiceSelect');
        if (voiceSelect) {
            voiceSelect.innerHTML = this.voices
                .map(voice => `<option value="${voice.voiceURI}">${voice.name}</option>`)
                .join('');
        }
    }

    // GPT-4 Integration
    async processWithGPT4(content, action) {
        this.setNuraStatus('processing', 'Processing with GPT-4...');
        try {
            const response = await fetch('/api/gpt4', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    content,
                    action,
                    options: {
                        model: 'gpt-4-turbo',
                        temperature: 0.7,
                        maxTokens: 4000,
                        stream: true
                    }
                })
            });

            // Handle streaming response
            const reader = response.body.getReader();
            let result = '';

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                const text = new TextDecoder().decode(value);
                result += text;
                
                // Update UI with streaming response
                this.updateStreamingResponse(text);
            }

            return result;
        } catch (error) {
            throw new Error('GPT-4 processing failed: ' + error.message);
        } finally {
            this.setNuraStatus('ready', 'Nura is ready');
        }
    }

    // Quick Actions
    async executeQuickAction(action) {
        const content = await this.getFrameContent();
        if (!content) {
            this.showError('No content to process');
            return;
        }

        try {
            const result = await this.processWithGPT4(content, action);
            this.addToHistory('ai', { action, content: result });
            await this.speakText(result);
            return result;
        } catch (error) {
            this.showError(`Failed to execute ${action}`);
            console.error(`Quick action error (${action}):`, error);
        }
    }

    // Playlist Management
    addToPlaylist(url, action) {
        if (this.playlist.length >= 10) {
            this.showError('Maximum playlist size (10) reached');
            return;
        }

        const item = {
            id: crypto.randomUUID(),
            url,
            action,
            status: 'pending',
            result: null,
            timestamp: new Date(),
            settings: {
                speed: parseFloat(this.speedSelect.value),
                autoPlay: document.getElementById('autoPlayPlaylist')?.checked || false
            }
        };

        this.playlist.push(item);
        this.renderPlaylistItem(item);
        this.updatePlaylistCount();
    }

    renderPlaylistItem(item) {
        const itemElement = document.createElement('div');
        itemElement.className = 'playlist-item';
        itemElement.dataset.id = item.id;

        itemElement.innerHTML = `
            <div class="item-content">
                <div class="item-header">
                    <span class="item-url">${item.url}</span>
                    <span class="item-action">${item.action}</span>
                </div>
                ${item.result ? `
                    <div class="item-result">${item.result.substring(0, 100)}...</div>
                ` : ''}
            </div>
            <div class="item-controls">
                <button class="item-play" ${!item.result ? 'disabled' : ''}>
                    <svg>...</svg>
                </button>
                <button class="item-remove">
                    <svg>...</svg>
                </button>
            </div>
        `;

        this.playlistItems.appendChild(itemElement);
    }

    async processPlaylist() {
        if (this.isProcessing) return;

        this.isProcessing = true;
        this.setNuraStatus('processing', 'Processing playlist...');

        for (const item of this.playlist) {
            if (item.status === 'pending') {
                try {
                    // Update UI to show current item
                    this.updatePlaylistItemStatus(item.id, 'processing');
                    
                    // Process the item
                    const result = await this.executeQuickAction(item.action);
                    
                    // Update item with result
                    item.result = result;
                    item.status = 'completed';
                    this.updatePlaylistItemStatus(item.id, 'completed');

                    // Auto-play if enabled
                    if (item.settings.autoPlay) {
                        await this.speakText(result, item.settings.speed);
                    }
                } catch (error) {
                    item.status = 'error';
                    this.updatePlaylistItemStatus(item.id, 'error');
                    console.error('Playlist item processing error:', error);
                }
            }
        }

        this.isProcessing = false;
        this.setNuraStatus('ready', 'Nura is ready');
    }
        // Audio Processing and Controls
    async speakText(text, speed = null) {
        if (!this.synthesis) {
            this.showError('Speech synthesis not available');
            return;
        }

        // Cancel any ongoing speech
        this.synthesis.cancel();

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = speed || parseFloat(this.speedSelect.value);
        utterance.voice = this.voices.find(voice => 
            voice.voiceURI === document.getElementById('voiceSelect').value
        );

        // Handle speech events
        utterance.onstart = () => {
            this.isPlaying = true;
            this.updatePlayPauseButton();
            this.startAudioTimer();
        };

        utterance.onend = () => {
            this.isPlaying = false;
            this.updatePlayPauseButton();
            this.stopAudioTimer();
        };

        utterance.onerror = (event) => {
            this.showError('Speech synthesis error: ' + event.error);
            this.isPlaying = false;
            this.updatePlayPauseButton();
            this.stopAudioTimer();
        };

        this.currentUtterance = utterance;
        this.synthesis.speak(utterance);
    }

    startAudioTimer() {
        let startTime = Date.now() - (this.currentAudioDuration || 0);
        this.audioTimer = setInterval(() => {
            this.currentAudioDuration = Date.now() - startTime;
            this.updateAudioTimer();
        }, 100);
    }

    stopAudioTimer() {
        if (this.audioTimer) {
            clearInterval(this.audioTimer);
            this.audioTimer = null;
        }
    }

    updateAudioTimer() {
        const seconds = Math.floor(this.currentAudioDuration / 1000);
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        this.audioTimer.textContent = 
            `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    pauseAudio() {
        if (this.synthesis && this.isPlaying) {
            this.synthesis.pause();
            this.isPlaying = false;
            this.stopAudioTimer();
            this.updatePlayPauseButton();
        }
    }

    resumeAudio() {
        if (this.synthesis && !this.isPlaying) {
            this.synthesis.resume();
            this.isPlaying = true;
            this.startAudioTimer();
            this.updatePlayPauseButton();
        }
    }

    // Export Functionality
    async exportToWav() {
        if (!this.currentUtterance) {
            this.showError('No audio content to export');
            return;
        }

        try {
            const audioContext = new AudioContext();
            const audioBuffer = await this.textToAudioBuffer(this.currentUtterance.text);
            const wavBlob = await this.audioBufferToWav(audioBuffer);
            
            // Create download link
            const url = URL.createObjectURL(wavBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `neuralcloud_${Date.now()}.wav`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        } catch (error) {
            this.showError('Failed to export audio');
            console.error('Audio export error:', error);
        }
    }

    async exportToText(content) {
        try {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `neuralcloud_${Date.now()}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        } catch (error) {
            this.showError('Failed to export text');
            console.error('Text export error:', error);
        }
    }

    // History Management
    addToHistory(type, entry) {
        const historyEntry = {
            id: crypto.randomUUID(),
            timestamp: new Date(),
            ...entry
        };

        this.history[type].push(historyEntry);
        this.renderHistoryEntry(type, historyEntry);
        this.saveHistory();
    }

    renderHistoryEntry(type, entry) {
        const historyContent = document.getElementById('historyContent');
        const entryElement = document.createElement('div');
        entryElement.className = 'history-entry';
        entryElement.dataset.id = entry.id;

        entryElement.innerHTML = `
            <div class="entry-header">
                <span class="entry-timestamp">
                    ${new Date(entry.timestamp).toLocaleTimeString()}
                </span>
                ${type === 'ai' ? `
                    <span class="entry-action">${entry.action}</span>
                ` : ''}
            </div>
            <div class="entry-content">
                ${type === 'browsing' ? 
                    `<a href="${entry.url}" class="entry-url">${entry.url}</a>` :
                    `<div class="entry-text">${entry.content.substring(0, 100)}...</div>`
                }
            </div>
            <div class="entry-actions">
                ${type === 'ai' ? `
                    <button class="entry-play" title="Play">
                        <svg>...</svg>
                    </button>
                    <button class="entry-export" title="Export">
                        <svg>...</svg>
                    </button>
                ` : ''}
            </div>
        `;

        historyContent.insertBefore(entryElement, historyContent.firstChild);
    }

    // Settings Management
    loadSettings() {
        try {
            const settings = JSON.parse(localStorage.getItem('neuralcloud_settings')) || {};
            this.applySettings(settings);
        } catch (error) {
            console.error('Failed to load settings:', error);
            // Use defaults
            this.applySettings({});
        }
    }

    applySettings(settings) {
        // Voice settings
        document.getElementById('voiceSelect').value = settings.voiceUri || '';
        document.getElementById('defaultSpeed').value = settings.defaultSpeed || '1';
        document.getElementById('autoPlayPlaylist').checked = settings.autoPlayPlaylist || false;

        // Apply other settings as needed
        this.speedSelect.value = settings.defaultSpeed || '1';
    }

    saveSettings() {
        const settings = {
            voiceUri: document.getElementById('voiceSelect').value,
            defaultSpeed: document.getElementById('defaultSpeed').value,
            autoPlayPlaylist: document.getElementById('autoPlayPlaylist').checked
        };

        try {
            localStorage.setItem('neuralcloud_settings', JSON.stringify(settings));
            this.showSuccess('Settings saved successfully');
        } catch (error) {
            this.showError('Failed to save settings');
            console.error('Settings save error:', error);
        }
    }

    // Error Handling and UI Feedback
    showError(message, duration = 5000) {
        this.showNotification(message, 'error', duration);
    }

    showSuccess(message, duration = 3000) {
        this.showNotification(message, 'success', duration);
    }

    showNotification(message, type, duration) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.textContent = message;

        document.body.appendChild(notification);

        // Trigger animation
        setTimeout(() => notification.classList.add('show'), 10);

        // Remove after duration
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, duration);
    }

    // UI Updates
    updatePlayPauseButton() {
        const icon = this.playPauseButton.querySelector('svg');
        if (this.isPlaying) {
            icon.innerHTML = `
                <rect x="6" y="4" width="4" height="16"/>
                <rect x="14" y="4" width="4" height="16"/>
            `;
        } else {
            icon.innerHTML = `
                <polygon points="5 3 19 12 5 21 5 3"/>
            `;
        }
    }

    setNuraStatus(state, message) {
        this.nuraStatus.className = `nura-status ${state}`;
        this.nuraStatus.querySelector('span').textContent = message;
    }

    // Event Listeners
    setupEventListeners() {
        // Voice input events
        this.urlMicButton.addEventListener('click', () => this.toggleVoiceInput('url'));
        this.commandMicButton.addEventListener('click', () => this.toggleVoiceInput('command'));

        // Audio control events
        this.playPauseButton.addEventListener('click', () => 
            this.isPlaying ? this.pauseAudio() : this.resumeAudio()
        );
        this.stopButton.addEventListener('click', () => this.stopAudio());
        this.speedSelect.addEventListener('change', () => this.updateSpeed());

        // Export events
        this.exportWavButton.addEventListener('click', () => this.exportToWav());
        this.exportTextButton.addEventListener('click', () => {
            const content = this.currentUtterance?.text;
            if (content) this.exportToText(content);
        });

        // Quick action events
        Object.entries(this.quickActionButtons).forEach(([action, button]) => {
            button.addEventListener('click', () => this.executeQuickAction(action));
        });

        // Playlist events
        this.processAllButton.addEventListener('click', () => this.processPlaylist());

        // Settings events
        document.getElementById('saveSettings')?.addEventListener('click', () => this.saveSettings());
        document.getElementById('cancelSettings')?.addEventListener('click', () => 
            document.getElementById('settingsModal').classList.remove('active')
        );
    }
}

// Initialize when document is ready
document.addEventListener('DOMContentLoaded', () => {
    window.neuralCloud = new NeuralCloudBrowser();
});
    </script>
</body>
</html>
